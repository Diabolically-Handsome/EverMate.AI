# 🐾 EverMate.AI（v1.0 まもなく）
あなたのローカル相棒 AI · プライバシー最優先 · 可能な限りオフライン

[English (Canada)](README.en-CA.md) · [中文](README.zh-CN.md) · [Português (Brasil)](README.pt-BR.md) · [Français (Canada)](README.fr-CA.md) · [日本語](README.ja-JP.md)

## ✨ 概要
EverMate.AI は**長期の相棒チャット**を現実的に。標準でローカル実行・送信なし。二つの柱――**三層メモリ**と**拡張可能なローカル索引**で、膨大な履歴を短く正確に活用します。

## 🍱 特長
### 1) 三層メモリ（Core → Persona → Vault）
- **Core**：頻出トピック＋話し方/応答テンプレ（例：丁寧語、例を添える、柔らかい口調）。多くの質問はまずここで即ヒット。  
- **Persona**：コミュニケーション嗜好、情報量、長期的関心、NG を**最大 8 行**に要約。Ollama のローカル LLM を優先、なければヒューリスティックで安定出力。  
- **Vault**：残りは**チャンク化してディスク保存**、必要な時だけ検索して**原文の一文**を取り出します。  
- **衝突時ルール**：履歴より**今回の入力**を優先。

### 2) 拡張可能なローカル索引（Large‑scale / Local / Fast）
- **チャンク化**：1 チャンク約 2.8K 文字（調整可）。数百万語規模を想定。  
- **倒立インデックス**：SQLite の `terms/postings/chunks`＋WAL モードで堅牢。  
- **BM25 検索**：候補チャンクをランク付けし、**最適な原文センテンス**を文脈へ。  
- **ストリーミング構築 & 増分更新**：`.docx/.txt` をドラッグで読み込みながら構築。新規チャットは**ターンごと**に追加、一定数ごとに Core/Persona を自動更新。

## 🚀 はじめかた
1. プロジェクト直下で `python app.py`。  
2. 使い方は 2 通り：  
   - **履歴をインポート**：`.docx/.txt` をドラッグ → 「構築/再構築」を押して会話開始。  
   - **新しい相棒**：そのまま会話開始。各ターンが索引に追加され、閾値で Core/Persona が更新。  
3. 任意：**Ollama**（`OLLAMA_URL`、`OLLAMA_MODEL`）を設定すると Persona がより自然に。

## 💼 仕組み（ひとことで）
**Core** でスタイルと頻出、**Persona** であなたの嗜好、**Vault** で根拠文。**短く的確**な文脈を維持します。

## 🧲 インポート vs 新規（同じエンジン）
- **ドラッグ＆ドロップ**：`.docx` は標準ライブラリで解析、`.txt` はストリーム読み。  
- **新規相棒**：`append_turn` で増分書き込み、デフォルトは**20** 新規チャンクごとに更新。

## 🔧 調整項目
`CHUNK_CHARS`=2800 / `CORE_TOP_TERMS`=50 / `PERSONA_MAX_BULLETS`=8 / `REFRESH_EVERY`=20 / `retrieve(query,k)`=4～8

## 🛡️ プライバシーとローカル優先
原則ローカル保存・ローカル実行。リモートモデルを使う場合は運用ポリシーを確認。`memory` フォルダの暗号化とバックアップを推奨。

## ❓FAQ
- Persona が変わらない？ 更新閾値未満の可能性。会話を続けるか再構築、`REFRESH_EVERY` を下げても OK。  
- **原文**を見たい？ 可能です。Vault が最適な一文/断片を返します。  
- 索引が肥大化？ `CHUNK_CHARS` を大きく、古い `chunks` をアーカイブ、友だちごとに `memory` を分離。  
- ローカル LLM が無い？ Persona の精度のみ低下。全体フローは継続。  
- 過去に“引っ張られる”感じ？ **今回の入力**を最優先。`01_core.md` / `02_persona.md` を調整して再構築も可。

## 🗺️ ロードマップ
ハイブリッド検索（BM25+ローカル埋め込み）、トピック分桶/タイムライン、根拠可視化、メモリ減衰、イベントカード。

## 📦 構成
```
memory/
  index.sqlite
  chunks/
  uploads/
  buffer.txt
  01_core.md
  02_persona.md
  03_vault.md
```

## 📜 ライセンス
MIT（LICENSE 参照）
